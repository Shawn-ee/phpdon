webpackJsonp([10],{"7ZAJ":function(e,t){},HRYs:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("mvHQ"),n=r.n(a),i=r("Xxa5"),o=r.n(i),s=r("exGp"),l=r.n(s),c=r("PJh5"),m=r.n(c),p={data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(m()(m()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},transfreTypeList:[{id:1,title:"距离最近"},{id:2,title:"最早可预约"}],carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付"},statusType:{"-1":"已取消",1:"待支付",2:"待服务",3:"技师接单",4:"技师出发",5:"技师到达",6:"服务中",7:"已完成",8:"待转单"},cityType:{3:{type:"success",text:"省"},1:{type:"primary",text:"城市"},2:{type:"danger",text:"区县"}},loading:{list:!1,transfer:!1},searchForm:{list:{page:1,limit:10,order_code:"",mobile:"",start_time:"",end_time:"",pay_type:8},transfer:{page:1,limit:10,order_id:"",type:1}},tableData:{list:[],transfer:[]},total:{list:0,transfer:0},order_price:0,car_price:0,downloadLoading:!1,showDialog:{transfer:!1},transferForm:{order_id:"",coach_type:1,coach_id:"",coach_name:"",mobile:"",text:""},transferSubFormRules:{coach_name:{required:!0,validator:this.$reg.isNotNull,text:"技师姓名",reg_type:2,trigger:"blur"},mobile:{required:!0,validator:this.$reg.isTel,text:"联系电话",reg_type:2,trigger:"blur"},text:{required:!0,validator:this.$reg.isNotNull,text:"其他备注",reg_type:2,trigger:"blur"}},lockTap:!1}},created:function(){var e=this;return l()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.getTableDataList(1,"list");case 1:case"end":return t.stop()}},t,e)}))()},methods:{resetForm:function(e){var t=e+"Form";this.$refs[t].resetFields(),this.getTableDataList(1,e)},handleSizeChange:function(e,t){this.searchForm[t].limit=e,this.handleCurrentChange(1,t)},handleCurrentChange:function(e,t){this.searchForm[t].page=e,this.getTableDataList("",t)},getTableDataList:function(e,t){var r=this;e&&(this.searchForm[t].page=1),this.loading[t]=!0;var a=JSON.parse(n()(this.searchForm[t]));if("list"===t){var i=a.start_time;i&&i.length>0?(a.start_time=i[0]/1e3,a.end_time=i[1]/1e3):(a.start_time="",a.end_time="")}var o={list:"orderList",transfer:"orderChangeCoachList"}[t];this.$api.shop[o](a).then(function(e){if(r.loading[t]=!1,200===e.code){var a=e.data,n=a.data,i=a.total;r.tableData[t]=n,r.total[t]=i}})},toShowDialog:function(e,t){var r=this;return l()(o.a.mark(function a(){var i;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(i in t=JSON.parse(n()(t)),r[e+"Form"])r[e+"Form"][i]=t[i];if("transfer"!==e){a.next=7;break}return r.searchForm.transfer.order_id=t.order_id,r.searchForm.transfer.type=1,a.next=7,r.getTableDataList(1,e);case 7:r.showDialog[e]=!0;case 8:case"end":return a.stop()}},a,r)}))()},changeCoachType:function(){this.transferForm.coach_name="",this.transferForm.text=""},handleTableChange:function(e,t){e=JSON.parse(n()(e)),this.currentRow=e},handleDialogConfirm:function(){var e=this;return l()(o.a.mark(function t(){var r,a,i,s,l,c,m,p,u,d,f,_;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,a=JSON.parse(n()(e.transferForm)),i=a.coach_type,1!==(void 0===i?1:i)){t.next=13;break}if(null!==e.currentRow&&e.currentRow.id){t.next=7;break}return e.$message.error("请选择技师"),t.abrupt("return");case 7:s=e.currentRow,l=s.id,c=void 0===l?0:l,m=s.coach_name,p=void 0===m?"":m,u=s.near_time,d=void 0===u?"":u,a.coach_id=c,a.coach_name=p,a.near_time=d,t.next=15;break;case 13:a.coach_id=0,e.$refs.transferSubForm.validate(function(e){e||(r=!1)});case 15:if(delete a.coach_type,!e.lockTap&&r){t.next=18;break}return t.abrupt("return");case 18:return e.lockTap=!0,t.next=21,e.$api.shop.orderChangeCoach(a);case 21:if(f=t.sent,_=f.code,e.lockTap=!1,200===_){t.next=26;break}return t.abrupt("return");case 26:e.$message.success(e.$t("tips.successOper")),e.getTableDataList("","list"),e.showDialog.transfer=!1;case 29:case"end":return t.stop()}},t,e)}))()},toPassRefund:function(e){var t=this;return l()(o.a.mark(function r(){var a;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=t.$createElement,t.$confirm(a("p",null,[a("p",null,"你确认要操作退款吗？"),a("p",{style:"font-size:13px;line-height:1.2;color: red"},"退款金额：¥"+e.price)]),t.$t("tips.reminder"),{confirmButtonText:t.$t("action.comfirm"),cancelButtonText:t.$t("action.cancel"),type:"warning"}).then(function(){t.lockTap||(t.lockTap=!0,t.$api.shop.adminUpdateOrder(e).then(function(e){t.lockTap=!1,200===e.code&&(t.$message.success(t.$t("tips.successOper")),t.getTableDataList("","list"))}))});case 2:case"end":return r.stop()}},r,t)}))()}},filters:{handleTime:function(e,t){return 1===t?m()(1e3*e).format("YYYY-MM-DD"):2===t?m()(1e3*e).format("HH:mm:ss"):m()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-shop-order"},[r("top-nav"),e._v(" "),r("div",{staticClass:"page-main"},[r("el-row",{staticClass:"page-search-form"},[r("el-form",{ref:"listForm",attrs:{inline:!0,model:e.searchForm.list},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[r("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:e.searchForm.list.order_code,callback:function(t){e.$set(e.searchForm.list,"order_code",t)},expression:"searchForm.list.order_code"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"下单手机号",prop:"mobile"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入下单时填写的手机号"},model:{value:e.searchForm.list.mobile,callback:function(t){e.$set(e.searchForm.list,"mobile",t)},expression:"searchForm.list.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"日期",prop:"start_time"}},[r("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.list.start_time,callback:function(t){e.$set(e.searchForm.list,"start_time",t)},expression:"searchForm.list.start_time"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"list")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("list")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.list,expression:"loading.list"}],staticStyle:{width:"100%"},attrs:{data:e.tableData.list,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[r("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",fixed:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"goods_info_text",width:"300",label:"服务项目信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.order_goods,function(t,a){return r("div",{key:a,staticClass:"pb-sm"},[r("div",{staticClass:"flex-center pt-md"},[r("lb-image",{staticClass:"avatar radius-5",attrs:{src:t.goods_cover}}),e._v(" "),r("div",{staticClass:"flex-1 f-caption c-caption ml-md",staticStyle:{width:"210px"}},[r("div",{staticClass:"flex-between"},[r("div",{staticClass:"f-paragraph c-title ellipsis",class:[{"max-300":t.refund_num>0}],staticStyle:{"line-height":"1.2","margin-bottom":"4px"}},[e._v("\n                    "+e._s(t.goods_name)+"\n                  ")]),e._v(" "),t.refund_num>0?r("div",{staticClass:"f-caption c-warning"},[e._v("\n                    已退x"+e._s(t.refund_num)+"\n                  ")]):e._e()]),e._v(" "),r("div",{staticClass:"f-caption",staticStyle:{"line-height":"1.4"}},[e._v("\n                  时长："+e._s(t.time_long)+" 分钟\n                ")]),e._v(" "),r("div",{staticClass:"flex-between f-caption mt-sm",staticStyle:{"line-height":"1.4"}},[r("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.price))]),e._v(" "),r("div",[e._v("x"+e._s(t.num))])])])],1)])})}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"user_name",label:"下单人","min-width":"120"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile","min-width":"120",label:"下单手机号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"coach_info.coach_name",label:"原技师","min-width":"120"}}),e._v(" "),r("el-table-column",{attrs:{prop:"start_time","min-width":"120",label:"服务开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,1)))]),e._v(" "),r("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"car_type","min-width":"250",label:"出行费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("\n            "+e._s(e.carType[t.row.car_type])+"\n          ")]),e._v(" "),1==t.row.car_type?r("div",{staticClass:"flex-y-center"},[e._v("\n            全程"+e._s(t.row.distance)+"，车费¥"+e._s(t.row.car_price)+"\n          ")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"init_service_price",width:"120",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.init_service_price)+"\n        ")]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"pay_price",label:"实收金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("¥"+e._s(t.row.pay_price))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"order_code",width:"150",label:"系统订单号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"transaction_id",width:"150",label:"付款订单号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"create_time","min-width":"120",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),r("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"pay_model",label:"支付方式","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.payType[t.row.pay_model])+"\n        ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"table-operate"},[r("lb-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(r){return e.$router.push("/shop/order/detail?id="+t.row.id)}}},[e._v(e._s(e.$t("action.view")))]),e._v(" "),r("lb-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(r){return e.toShowDialog("transfer",{order_id:t.row.id,coach_type:1})}}},[e._v("转单")]),e._v(" "),r("lb-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(r){return e.toPassRefund({type:-1,order_id:t.row.id,price:t.row.pay_price})}}},[e._v("立即退款")])],1)]}}])})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.list.page,pageSize:e.searchForm.list.limit,total:e.total.list},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"list")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"list")}}}),e._v(" "),r("el-dialog",{attrs:{title:"转派技师",visible:e.showDialog.transfer,width:"1000px",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"transfer",t)}}},[r("el-form",{ref:"transferSubForm",staticClass:"dialog-form",attrs:{model:e.transferForm,rules:e.transferSubFormRules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"转派订单",prop:"coach_type"}},[r("el-radio-group",{on:{change:e.changeCoachType},model:{value:e.transferForm.coach_type,callback:function(t){e.$set(e.transferForm,"coach_type",t)},expression:"transferForm.coach_type"}},[r("el-radio",{attrs:{label:1}},[e._v("转派线上技师")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("转派线下技师")])],1)],1),e._v(" "),2===e.transferForm.coach_type?r("block",[r("el-form-item",{attrs:{label:"线下技师",prop:"coach_name"}},[r("el-input",{attrs:{placeholder:"请输入线下技师姓名",maxlength:"15","show-word-limit":""},model:{value:e.transferForm.coach_name,callback:function(t){e.$set(e.transferForm,"coach_name",t)},expression:"transferForm.coach_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[r("el-input",{attrs:{placeholder:"请输入联系电话",maxlength:"11","show-word-limit":""},model:{value:e.transferForm.mobile,callback:function(t){e.$set(e.transferForm,"mobile",t)},expression:"transferForm.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"转派备注",prop:"text"}},[r("el-input",{attrs:{type:"textarea",rows:10,maxlength:"400","show-word-limit":"",resize:"none",placeholder:"可备注技师提成、渠道、分销商等角色提成金额，以便线下结算"},model:{value:e.transferForm.text,callback:function(t){e.$set(e.transferForm,"text",t)},expression:"transferForm.text"}})],1)],1):e._e()],1),e._v(" "),1===e.transferForm.coach_type?r("div",{staticStyle:{"padding-left":"10px"}},[r("el-form",{ref:"transferForm",attrs:{inline:!0,model:e.searchForm.transfer,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"coach_name"}},[r("el-input",{attrs:{placeholder:"请输入技师姓名"},model:{value:e.searchForm.transfer.coach_name,callback:function(t){e.$set(e.searchForm.transfer,"coach_name",t)},expression:"searchForm.transfer.coach_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"筛选排序",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1,"transfer")}},model:{value:e.searchForm.transfer.type,callback:function(t){e.$set(e.searchForm.transfer,"type",t)},expression:"searchForm.transfer.type"}},e._l(e.transfreTypeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"transfer")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("transfer")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.transfer,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark","highlight-current-row":""},on:{"current-change":e.handleTableChange}},[r("el-table-column",{attrs:{prop:"coach_name",label:"技师姓名"}}),e._v(" "),r("el-table-column",{attrs:{prop:"work_img",width:"150",label:"技师头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("lb-image",{attrs:{src:e.row.work_img}})]}}],null,!1,1359628658)}),e._v(" "),r("el-table-column",{attrs:{prop:"distance",label:"距离"}}),e._v(" "),r("el-table-column",{attrs:{prop:"near_time",label:"最早可预约"}}),e._v(" "),r("el-table-column",{attrs:{prop:"admin_info.user_name",label:"所属代理商"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.admin_id?r("div",[e._v("平台")]):r("div",[r("div",[e._v(e._s(t.row.admin_info.username))]),e._v(" "),r("el-tag",{attrs:{type:e.cityType[t.row.admin_info.city_type].type,size:"medium"}},[e._v(e._s(e.cityType[t.row.admin_info.city_type].text)+"代理")])],1)]}}],null,!1,1830304008)}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"联系电话"}})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.transfer.page,pageSize:e.searchForm.transfer.limit,total:e.total.transfer},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"transfer")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"transfer")}}})],1):e._e(),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.transfer=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var d=r("VU/8")(p,u,!1,function(e){r("7ZAJ"),r("rFm1")},"data-v-65257cf8",null);t.default=d.exports},rFm1:function(e,t){}});