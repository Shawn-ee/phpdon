webpackJsonp([13],{"/fIh":function(e,t){},"9wSi":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("aFK5"),n=a.n(r),l=a("mvHQ"),i=a.n(l),o=a("Xxa5"),s=a.n(o),c=a("exGp"),p=a.n(c),_=a("PJh5"),d=a.n(_),m={data:function(){return{loading:!1,downloadLoading:!1,print:!1,searchForm:{page:1,limit:10,goods_name:"",coach_name:"",is_channel:1,channel_name:"",channel_cate_id:0,order_code:"",mobile:"",start_time:"",end_time:"",pay_type:0},base_channel:[],pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(d()(d()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},statusOptions:[{label:"全部订单",value:0},{label:"待服务",value:2},{label:"技师接单",value:3},{label:"技师出发",value:4},{label:"技师到达",value:5},{label:"服务中",value:6},{label:"已完成",value:7}],carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付"},statusType:{"-1":"已取消",1:"待支付",2:"待服务",3:"技师接单",4:"技师出发",5:"技师到达",6:"服务中",7:"已完成"},printTableData:[],tableData:[],total:0,order_price:0}},created:function(){var e=this;return p()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getBaseInfo();case 2:e.getTableDataList();case 3:case"end":return t.stop()}},t,e)}))()},methods:{getBaseInfo:function(){var e=this;return p()(s.a.mark(function t(){var a,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.channel.cateSelect();case 2:a=t.sent,(r=a.data).unshift({id:0,title:"全部"}),e.base_channel=r;case 6:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;e&&(this.searchForm.page=1),this.loading=!0;var a=JSON.parse(i()(this.searchForm)),r=a.start_time;r&&r.length>0?(a.start_time=r[0]/1e3,a.end_time=r[1]/1e3):(a.start_time="",a.end_time=""),this.$api.shop.orderList(a).then(function(e){if(t.loading=!1,200===e.code){var a=e.data,r=a.data,n=a.total,l=a.order_price;r.map(function(e){e.is_balance=1*e.balance>0?1:0,e.refund_price=1*e.refund_price>0?e.refund_price:""}),t.tableData=r,t.total=n,t.order_price=l;var i=r.map(function(e){e.goods_text="",e.order_goods.map(function(t){e.goods_text+=t.goods_name+" 数量：x"+t.num+"；"});var a=1===e.car_type?"全程"+e.distance+"，车费"+e.car_price:"";return e.car_text=""+t.carType[e.car_type]+a,[e.id,e.goods_text,e.user_name,e.mobile,e.coach_name,e.channel_name,e.channel,d()(1e3*e.start_time).format("YYYY-MM-DD HH:mm:ss"),e.car_text,e.init_service_price,e.pay_price,e.refund_price,e.order_code,e.transaction_id,d()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),t.payType[e.pay_model],t.statusType[e.pay_type]]});t.printTableData=[["ID","服务项目信息","下单人","下单手机号","技师","渠道商","渠道","服务开始时间","出行费用","服务项目费用","实收金额","退款金额","系统订单号","付款订单号","下单时间","支付方式","状态"],i]}})},toExportExcel:function(){var e=this;this.downloadLoading=!0;var t=JSON.parse(i()(this.searchForm)),a=t.start_time;a&&a.length>0?(t.start_time=a[0]/1e3,t.end_time=a[1]/1e3):(t.start_time="",t.end_time="");var r=this.$util.getProCurrentHref(),l=r.indexOf("?")>0?"":"?",o=r.indexOf("?")>0;n()(t).forEach(function(e,a){l+=o?"&"+e+"="+t[e]:e+"="+t[e],o=!0});var s=window.localStorage.getItem("massage_minitk"),c=r+"/massage/admin/AdminExcel/orderList"+l+"&token="+s;window.location.href=c,setTimeout(function(){e.downloadLoading=!1},5e3)},printTable:function(){var e=this;this.print=!0,setTimeout(function(){e.$print(e.$refs.print),e.print=!1},50)}},filters:{handleTime:function(e,t){return 1===t?d()(1e3*e).format("YYYY-MM-DD"):2===t?d()(1e3*e).format("HH:mm:ss"):d()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-shop-order"},[a("top-nav"),e._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"服务名称",prop:"goods_name"}},[a("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.searchForm.goods_name,callback:function(t){e.$set(e.searchForm,"goods_name",t)},expression:"searchForm.goods_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"技师姓名",prop:"coach_name"}},[a("el-input",{attrs:{placeholder:"请输入技师姓名"},model:{value:e.searchForm.coach_name,callback:function(t){e.$set(e.searchForm,"coach_name",t)},expression:"searchForm.coach_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"渠道商姓名",prop:"channel_name"}},[a("el-input",{attrs:{placeholder:"请输入渠道商姓名"},model:{value:e.searchForm.channel_name,callback:function(t){e.$set(e.searchForm,"channel_name",t)},expression:"searchForm.channel_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"渠道",prop:"channel_cate_id"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.channel_cate_id,callback:function(t){e.$set(e.searchForm,"channel_cate_id",t)},expression:"searchForm.channel_cate_id"}},e._l(e.base_channel,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[a("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:e.searchForm.order_code,callback:function(t){e.$set(e.searchForm,"order_code",t)},expression:"searchForm.order_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"下单手机号",prop:"mobile"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入下单时填写的手机号"},model:{value:e.searchForm.mobile,callback:function(t){e.$set(e.searchForm,"mobile",t)},expression:"searchForm.mobile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"日期",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.start_time,callback:function(t){e.$set(e.searchForm,"start_time",t)},expression:"searchForm.start_time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"pay_type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.pay_type,callback:function(t){e.$set(e.searchForm,"pay_type",t)},expression:"searchForm.pay_type"}},e._l(e.statusOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"page-top-operate"},[a("lb-button",{attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-printer"},on:{click:e.printTable}},[e._v("打印")]),e._v(" "),a("lb-button",{attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.toExportExcel}},[e._v("导出")]),e._v(" "),a("div",[e._v("\n        共"+e._s(e.total)+"条数据，订单金额共计："+e._s(e.order_price)+"元"),a("lb-tool-tips",{attrs:{padding:0}},[e._v("此处订单金额不包含出行费用和已退款金额")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",fixed:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"goods_info_text",width:"300",label:"服务项目信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.order_goods,function(t,r){return a("div",{key:r,staticClass:"pb-sm"},[a("div",{staticClass:"flex-center pt-md"},[a("lb-image",{staticClass:"avatar radius-5",attrs:{src:t.goods_cover}}),e._v(" "),a("div",{staticClass:"flex-1 f-caption c-caption ml-md",staticStyle:{width:"210px"}},[a("div",{staticClass:"flex-between"},[a("div",{staticClass:"f-paragraph c-title ellipsis",class:[{"max-300":t.refund_num>0}],staticStyle:{"line-height":"1.2","margin-bottom":"4px"}},[e._v("\n                    "+e._s(t.goods_name)+"\n                  ")]),e._v(" "),t.refund_num>0?a("div",{staticClass:"f-caption c-warning"},[e._v("\n                    已退x"+e._s(t.refund_num)+"\n                  ")]):e._e()]),e._v(" "),a("div",{staticClass:"flex-between f-caption mt-md"},[a("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.price))]),e._v(" "),a("div",[e._v("x"+e._s(t.num))])])])],1)])})}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"下单人","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile","min-width":"120",label:"下单手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"coach_name",label:"技师","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channel_name",label:"渠道商","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channel",label:"渠道","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"start_time","min-width":"120",label:"服务开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"car_type","min-width":"250",label:"出行费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n            "+e._s(e.carType[t.row.car_type])+"\n          ")]),e._v(" "),1==t.row.car_type?a("div",{staticClass:"flex-y-center"},[e._v("\n            全程"+e._s(t.row.distance)+"，车费¥"+e._s(t.row.car_price)+"\n          ")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"init_service_price",width:"120",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.init_service_price)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_price",label:"实收金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("¥"+e._s(t.row.pay_price))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"refund_price",label:"退款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.refund_price?[a("div",[e._v("¥"+e._s(t.row.refund_price))])]:void 0}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"order_code",width:"150",label:"系统订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"transaction_id",width:"150",label:"付款订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time","min-width":"120",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_model",label:"支付方式","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.payType[t.row.pay_model])+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.statusType[t.row.pay_type])+"\n        ")]}}])})],1),e._v(" "),a("table",{directives:[{name:"show",rawName:"v-show",value:e.print,expression:"print"}],ref:"print",staticStyle:{"font-size":"12px"},attrs:{border:"0",cellspacing:"0",cellapdding:"0"}},[a("thead",[a("tr",e._l(e.printTableData[0],function(t,r){return a("th",{key:r,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)]),e._v(" "),a("tbody",e._l(e.printTableData[1],function(t,r){return a("tr",{key:r},e._l(t,function(t,r){return a("td",{key:r,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)}),0)]),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var h=a("VU/8")(m,u,!1,function(e){a("CEfw"),a("/fIh")},"data-v-40c8a570",null);t.default=h.exports},CEfw:function(e,t){}});