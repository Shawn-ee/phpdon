webpackJsonp([21],{"9bz8":function(e,t){},FGMy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("aFK5"),n=a.n(r),i=a("mvHQ"),o=a.n(i),s=a("Xxa5"),l=a.n(s),c=a("exGp"),d=a.n(c),p=a("PJh5"),_=a.n(p),u={data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(_()(_()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},statusOptions:[{label:"全部订单",value:0},{label:"已取消",value:-1},{label:"待支付",value:1},{label:"待服务",value:2},{label:"技师接单",value:3},{label:"服务中",value:6},{label:"已完成",value:7}],carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付"},statusType:{"-1":"已取消",1:"待支付",2:"待服务",3:"技师接单",4:"技师出发",5:"技师到达",6:"服务中",7:"已完成",8:"待转单"},technicianStatusType:{2:"技师接单",3:"开始服务",6:"完成服务"},loading:!1,downloadLoading:!1,print:!1,searchForm:{page:1,limit:10,goods_name:"",coach_name:"",order_code:"",mobile:"",start_time:"",end_time:"",pay_type:0,is_add:1},printTableData:[],tableData:[],total:0,order_price:0,car_price:0,lockTap:!1}},created:function(){var e=this;return d()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.getTableDataList();case 1:case"end":return t.stop()}},t,e)}))()},methods:{resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;e&&(this.searchForm.page=1),this.loading=!0;var a=JSON.parse(o()(this.searchForm)),r=a.start_time;r&&r.length>0?(a.start_time=r[0]/1e3,a.end_time=r[1]/1e3):(a.start_time="",a.end_time=""),this.$api.shop.orderList(a).then(function(e){if(t.loading=!1,200===e.code){var a=e.data,r=a.data,n=a.total,i=a.order_price,o=a.car_price;r.map(function(e){e.is_balance=1*e.balance>0?1:0,e.refund_price=1*e.refund_price>0?e.refund_price:""}),t.tableData=r,t.total=n,t.order_price=i,t.car_price=o;var s=r.map(function(e){return e.goods_text="",e.add_order_text="",e.order_goods.map(function(t,a){e.goods_text+=(0===a?"":"；")+t.goods_name+" 时长："+t.time_long+"分钟 单价：¥"+t.price+" 数量：x"+t.num}),e.add_pid&&e.add_pid.id&&(e.add_order_text=""+e.add_pid.order_code),[e.id,e.goods_text,e.user_name,e.mobile,e.coach_info.coach_name,_()(1e3*e.start_time).format("YYYY-MM-DD HH:mm:ss"),"¥"+e.init_service_price,e.refund_price?"¥"+e.refund_price:"",e.add_order_text,e.order_code,e.transaction_id,_()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),t.payType[e.pay_model],t.statusType[e.pay_type]]});t.printTableData=[["ID","服务项目信息","下单人","下单手机号","技师","服务开始时间","服务项目费用","退款金额","主订单号","系统订单号","付款订单号","下单时间","支付方式","状态"],s]}})},toOperOrderItem:function(e){var t=this;return d()(l.a.mark(function a(){var r,n;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:r=e.type,n={2:3,3:6,6:7},e.type=n[r],t.$confirm("你确认要操作"+t.technicianStatusType[r]+"吗",t.$t("tips.reminder"),{confirmButtonText:t.$t("action.comfirm"),cancelButtonText:t.$t("action.cancel"),type:"warning"}).then(function(){t.toConfirmOperOrder(e)}).catch(function(){});case 4:case"end":return a.stop()}},a,t)}))()},toConfirmOperOrder:function(e){var t=this;return d()(l.a.mark(function a(){var r,n;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.lockTap){a.next=2;break}return a.abrupt("return");case 2:return t.lockTap=!0,a.next=5,t.$api.shop.adminUpdateOrder(e);case 5:if(r=a.sent,n=r.code,t.lockTap=!1,200===n){a.next=10;break}return a.abrupt("return");case 10:t.$message.success(t.$t("tips.successOper")),t.getTableDataList("","list");case 12:case"end":return a.stop()}},a,t)}))()},toExportExcel:function(){var e=this;this.downloadLoading=!0;var t=JSON.parse(o()(this.searchForm)),a=t.start_time;a&&a.length>0?(t.start_time=a[0]/1e3,t.end_time=a[1]/1e3):(t.start_time="",t.end_time="");var r=this.$util.getProCurrentHref(),i=r.indexOf("?")>0?"":"?",s=r.indexOf("?")>0;n()(t).forEach(function(e,a){i+=s?"&"+e+"="+t[e]:e+"="+t[e],s=!0});var l=window.localStorage.getItem("massage_minitk"),c=r+"/massage/admin/AdminExcel/orderList"+i+"&token="+l;window.location.href=c,setTimeout(function(){e.downloadLoading=!1},5e3)},printTable:function(){var e=this;this.print=!0,setTimeout(function(){e.$print(e.$refs.print),e.print=!1},50)}},filters:{handleTime:function(e,t){return 1===t?_()(1e3*e).format("YYYY-MM-DD"):2===t?_()(1e3*e).format("HH:mm:ss"):_()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-shop-order"},[a("top-nav"),e._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"服务名称",prop:"goods_name"}},[a("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.searchForm.goods_name,callback:function(t){e.$set(e.searchForm,"goods_name",t)},expression:"searchForm.goods_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"技师姓名",prop:"coach_name"}},[a("el-input",{attrs:{placeholder:"请输入技师姓名"},model:{value:e.searchForm.coach_name,callback:function(t){e.$set(e.searchForm,"coach_name",t)},expression:"searchForm.coach_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[a("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:e.searchForm.order_code,callback:function(t){e.$set(e.searchForm,"order_code",t)},expression:"searchForm.order_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"下单手机号",prop:"mobile"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入下单时填写的手机号"},model:{value:e.searchForm.mobile,callback:function(t){e.$set(e.searchForm,"mobile",t)},expression:"searchForm.mobile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"日期",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.start_time,callback:function(t){e.$set(e.searchForm,"start_time",t)},expression:"searchForm.start_time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"pay_type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.pay_type,callback:function(t){e.$set(e.searchForm,"pay_type",t)},expression:"searchForm.pay_type"}},e._l(e.statusOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"page-top-operate"},[a("lb-button",{attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-printer"},on:{click:e.printTable}},[e._v("打印")]),e._v(" "),a("lb-button",{attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.toExportExcel}},[e._v("导出")])],1),e._v(" "),a("div",{staticClass:"pb-lg"},[e._v("\n      共"+e._s(e.total)+"条数据，订单金额共计："+e._s(e.order_price)+"元，车费共计："+e._s(e.car_price)+"元\n    ")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",fixed:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"goods_info_text",width:"300",label:"服务项目信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.order_goods,function(t,r){return a("div",{key:r,staticClass:"pb-sm"},[a("div",{staticClass:"flex-center pt-md"},[a("lb-image",{staticClass:"avatar radius-5",attrs:{src:t.goods_cover}}),e._v(" "),a("div",{staticClass:"flex-1 f-caption c-caption ml-md",staticStyle:{width:"210px"}},[a("div",{staticClass:"flex-between"},[a("div",{staticClass:"f-paragraph c-title ellipsis",class:[{"max-300":t.refund_num>0}],staticStyle:{"line-height":"1.2","margin-bottom":"4px"}},[e._v("\n                    "+e._s(t.goods_name)+"\n                  ")]),e._v(" "),t.refund_num>0?a("div",{staticClass:"f-caption c-warning"},[e._v("\n                    已退x"+e._s(t.refund_num)+"\n                  ")]):e._e()]),e._v(" "),a("div",{staticClass:"f-caption",staticStyle:{"line-height":"1.4"}},[e._v("\n                  时长："+e._s(t.time_long)+" 分钟\n                ")]),e._v(" "),a("div",{staticClass:"flex-between f-caption mt-sm",staticStyle:{"line-height":"1.4"}},[a("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.price))]),e._v(" "),a("div",[e._v("x"+e._s(t.num))])])])],1)])})}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"下单人","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile","min-width":"120",label:"下单手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"coach_info.coach_name",label:"技师","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"start_time","min-width":"120",label:"服务开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"init_service_price",width:"120",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.init_service_price)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"refund_price",label:"退款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.refund_price?[a("div",[e._v("¥"+e._s(t.row.refund_price))])]:void 0}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"add_pid",width:"150",label:"主订单号"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.add_pid&&t.row.add_pid.id?[a("div",{staticClass:"c-warning cursor-pointer",on:{click:function(a){return e.$router.push("/shop/order/detail?id="+t.row.add_pid.id)}}},[e._v("\n            "+e._s(t.row.add_pid.order_code)+"\n          ")])]:void 0}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"order_code",width:"150",label:"系统订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"transaction_id",width:"150",label:"付款订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time","min-width":"120",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_model",label:"支付方式","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.payType[t.row.pay_model])+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.statusType[t.row.pay_type])+"\n          "),t.row.coach_refund_time&&-1===t.row.pay_type?a("div",{staticClass:"f-icontext c-warning"},[e._v("\n            技师拒单\n          ")]):e._e(),e._v(" "),t.row.is_show?e._e():a("div",{staticClass:"f-icontext c-warning"},[e._v("\n            用户已删除\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table-operate"},[a("lb-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){return e.$router.push("/shop/order/detail?id="+t.row.id)}}},[e._v(e._s(e.$t("action.view")))]),e._v(" "),[2,3,4,5,6].includes(t.row.pay_type)?a("lb-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(a){return e.toOperOrderItem({order_id:t.row.id,type:t.row.pay_type})}}},[e._v(e._s(e.technicianStatusType[t.row.pay_type]))]):e._e()],1)]}}])})],1),e._v(" "),a("table",{directives:[{name:"show",rawName:"v-show",value:e.print,expression:"print"}],ref:"print",staticStyle:{"font-size":"12px"},attrs:{border:"0",cellspacing:"0",cellapdding:"0"}},[a("thead",[a("tr",e._l(e.printTableData[0],function(t,r){return a("th",{key:r,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)]),e._v(" "),a("tbody",e._l(e.printTableData[1],function(t,r){return a("tr",{key:r},e._l(t,function(t,r){return a("td",{key:r,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)}),0)]),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,m,!1,function(e){a("blY2"),a("9bz8")},"data-v-02c4a437",null);t.default=f.exports},blY2:function(e,t){}});