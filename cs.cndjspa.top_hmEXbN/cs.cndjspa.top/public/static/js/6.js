webpackJsonp([6],{"5PlU":function(t,e,s){var n=s("RY/4"),i=s("dSzd")("iterator"),a=s("/bQp");t.exports=s("FeBl").isIterable=function(t){var e=Object(t);return void 0!==e[i]||"@@iterator"in e||a.hasOwnProperty(n(e))}},BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},N3lc:function(t,e){},"Ot/s":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("//Fk"),i=s.n(n),a=s("d7EF"),r=s.n(a),o=s("Xxa5"),l=s.n(o),u=s("exGp"),c=s.n(u),p={data:function(){return{isSubmit:!1,isSubmitStatus:0,fileName:"",selectOptions:[],subForm:{app_id:[],key:"",version:"",content:"",wxapp_version:""},subFormRules:{key:{required:!0,type:"string",message:"请上传密钥",trigger:"change"},wxapp_version:{required:!0,type:"string",message:"请选择小程序代码版本",trigger:"change"}}}},created:function(){var t=this;return c()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getBaseInfo();case 2:case"end":return e.stop()}},e,t)}))()},methods:{getBaseInfo:function(){var t=this;return c()(l.a.mark(function e(){var s,n,a,o,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.all([t.$api.system.wxappVersion(),t.$api.system.wxUploadInfo()]);case 2:s=e.sent,n=r()(s,2),a=n[0],o=n[1],u=[],a.data.map(function(t){u.push({key:t})}),t.selectOptions=u,t.subForm=o.data;case 10:case"end":return e.stop()}},e,t)}))()},handleClose:function(){this.isSubmit=!1},handleBtnUplaod:function(t){this.fileName=t,this.$refs.inputFile.click()},uploadFiles:function(t){var e=this,s=t.target.files[0];if(s.name.indexOf("key")<0)this.$message.error("请上传key格式的文件");else{var n=new FormData;n.append("file[]",s),n.append("type","wxuploadkey"),this.$api.upload.uploadFiles(n).then(function(t){if(200===t.code){e.$message.success(e.$t("tips.successUpload")),e.subForm[e.fileName]=t.data[0].attachment;var s=e.$util.pick(e.subForm,["app_id","key","version","content"]);e.$api.system.wxUploadUpdate(s)}})}},submitFormInfo:function(t){var e=this;1!==this.isSubmitStatus?this.$refs[t].validate(function(t){if(t){var s=e.$util.pick(e.subForm,["app_id","key","version","content"]),n=e.$util.pick(e.subForm,["wxapp_version"]);e.$api.system.wxUploadUpdate(s).then(function(t){200===t.code&&(e.isSubmit=!0,e.isSubmitStatus=1,e.$api.system.uploadWxapp(n).then(function(t){e.isSubmit=!1,e.isSubmitStatus=0,t.data.msg&&e.$message({type:2e4===t.data.code?"success":"error",message:t.data.msg,duration:0,showClose:!0})}))})}}):this.isSubmit=!0}},filters:{handleFileName:function(t){return t?t.substring(t.lastIndexOf("/")+1):"请上传文件"}}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"lb-sys-sprowechat"},[s("top-nav"),t._v(" "),s("div",{staticClass:"page-main"},[s("el-form",{ref:"subForm",staticClass:"config-form",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"140px"},nativeOn:{submit:function(t){t.preventDefault()}}},[s("el-form-item",{attrs:{label:"代码上传密钥",prop:"key"}},[s("div",{staticClass:"upload-file-warp"},[s("div",{staticClass:"upload-file-warp-content"},[t._v("\n            "+t._s(t._f("handleFileName")(t.subForm.key))+"\n          ")]),t._v(" "),s("lb-button",{staticClass:"lb-cover-wrap",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.handleBtnUplaod("key")}}},[t._v(t._s(t.$t("action.upload")))])],1)]),t._v(" "),s("input",{ref:"inputFile",staticStyle:{display:"none"},attrs:{type:"file",accept:"text"},on:{change:t.uploadFiles}}),t._v(" "),s("el-form-item",{attrs:{label:"版本号",prop:"version"}},[s("el-input",{attrs:{type:"text",maxlength:"30","show-word-limit":"",placeholder:"请输入版本号"},model:{value:t.subForm.version,callback:function(e){t.$set(t.subForm,"version",e)},expression:"subForm.version"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"版本描述",prop:"content"}},[s("el-input",{attrs:{type:"text",maxlength:"30","show-word-limit":"",placeholder:"请输入版本描述"},model:{value:t.subForm.content,callback:function(e){t.$set(t.subForm,"content",e)},expression:"subForm.content"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"小程序代码版本",prop:"wxapp_version"}},[s("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:t.subForm.wxapp_version,callback:function(e){t.$set(t.subForm,"wxapp_version",e)},expression:"subForm.wxapp_version"}},t._l(t.selectOptions,function(t){return s("el-option",{key:t.key,attrs:{label:t.key,value:t.key}})}),1)],1),t._v(" "),s("el-form-item",[s("lb-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitFormInfo("subForm")}}},[t._v(t._s(t.$t("action.submit")))])],1)],1),t._v(" "),s("el-dialog",{attrs:{title:"温馨提示",visible:t.isSubmit,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.isSubmit=e}}},[s("div",{staticClass:"flex-center"},[s("div",{staticClass:"el-icon-loading",staticStyle:{"font-size":"20px"}}),t._v(" "),s("div",{staticClass:"flex-1 mr-lg",staticStyle:{display:"inline-block"}},[t._v("\n          代码正在上传中，请耐心等待！\n        ")])]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.isSubmit=!1}}},[t._v("知道了")])],1)])],1)],1)},staticRenderFns:[]};var d=s("VU/8")(p,f,!1,function(t){s("N3lc")},"data-v-39ea730c",null);e.default=d.exports},Xd32:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("5PlU")},d7EF:function(t,e,s){"use strict";e.__esModule=!0;var n=a(s("us/S")),i=a(s("BO1k"));function a(t){return t&&t.__esModule?t:{default:t}}e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return function(t,e){var s=[],n=!0,a=!1,r=void 0;try{for(var o,l=(0,i.default)(t);!(n=(o=l.next()).done)&&(s.push(o.value),!e||s.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}return s}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var n=s("77Pl"),i=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},"us/S":function(t,e,s){t.exports={default:s("Xd32"),__esModule:!0}}});