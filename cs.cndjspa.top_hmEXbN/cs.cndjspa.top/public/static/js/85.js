webpackJsonp([85],{"9Rsl":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("mvHQ"),a=r.n(s),i=r("Xxa5"),l=r.n(i),o=r("exGp"),n=r.n(o),u=r("Dd8w"),m=r.n(u),c={data:function(){var e=this;return{navTitle:"",subForm:{id:0,title:"",stock:"",type:0,full:"",discount:"",rule:"",text:"",time_limit:0,user_limit:1,day:1,end_time:"",start_time:"",send_type:0,status:1,service:[],top:0},send_type2Rules:{stock:{required:!0,type:"number",message:"请输入卡券库存",trigger:"blur"},user_limit:{required:!0,message:"请选择领取身份",trigger:"blur"}},send_typeRules:{title:{required:!0,message:"请输入卡券名称",trigger:"blur"},type:{required:!0,message:"请选择使用条件",trigger:"blur"},full:{validator:function(t,r,s){var a=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;0===e.subForm.type?a.test(r)?a.test(e.subForm.discount)?1*r<1*e.subForm.discount?s(new Error("优惠金额不能大于消费金额")):s():s(new Error("请输入优惠金额")):s(new Error("请输入消费金额")):1===e.subForm.type&&(a.test(e.subForm.discount)?s():s(new Error("请输入优惠金额")))},trigger:"change"},rule:{required:!0,type:"string",message:"请输入使用规则",trigger:"blur"},text:{required:!0,type:"string",message:"请输入优惠详情",trigger:"blur"},send_type:{required:!0,message:"请选择派发方式",trigger:"blur"},time_limit:{required:!0,message:"请选择使用时间",trigger:"blur"},start_time:{validator:function(t,r,s){0===e.subForm.time_limit&&0===r.length?s(new Error("请选择开始时间")):s()},trigger:"change"},end_time:{validator:function(t,r,s){0===e.subForm.time_limit&&0===r.length?s(new Error("请选择到期时间")):s()},trigger:"change"},top:{required:!0,type:"number",message:"请输入排序值",trigger:"blur"},service:{required:!0,type:"array",message:"请选择限用服务",trigger:"blur"}},subFormRules:{},searchForm:{page:1,limit:10,status:1,name:""},total:0,loading:!1,tableData:[],multipleSelection:[],showDialog:!1}},watch:{"subForm.send_type":{handler:function(e,t){this.subFormRules=this.send_typeRules,2==e&&(this.subFormRules=m()({},this.send_typeRules,this.send_type2Rules))},deep:!0}},created:function(){this.subFormRules=this.send_typeRules;var e=this.$route.query.id,t=void 0===e?0:e;this.subForm.id=t,this.navTitle=this.$t(t?"menu.MarketCouponEdit":"menu.MarketCouponAdd"),t&&this.getDetail()},methods:{getDetail:function(){var e=this;return n()(l.a.mark(function t(){var r,s,a,i,o;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.subForm.id,t.next=3,e.$api.market.couponInfo({id:r});case 3:if(s=t.sent,a=s.code,i=s.data,200===a){t.next=8;break}return t.abrupt("return");case 8:for(o in i.start_time=i.start_time?1e3*i.start_time:"",i.end_time=i.end_time?1e3*i.end_time:"",e.subForm)e.subForm[o]=i[o];case 11:case"end":return t.stop()}},t,e)}))()},toShowDialog:function(){var e=this;return n()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getTableDataList();case 2:e.showDialog=!e.showDialog;case 3:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;return n()(l.a.mark(function r(){var s,a,i;return l.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e&&(t.searchForm.page=1),t.loading=!0,r.next=4,t.$api.service.serviceList(t.searchForm);case 4:if(s=r.sent,a=s.code,i=s.data,t.loading=!1,200===a){r.next=10;break}return r.abrupt("return");case 10:t.tableData=i.data,t.total=i.total;case 12:case"end":return r.stop()}},r,t)}))()},handleSelectionChange:function(e){this.multipleSelection=e},handleDialogConfirm:function(){var e=JSON.parse(a()(this.subForm.service)),t=e.length>0?e.map(function(e){return e.id}):[];this.multipleSelection.map(function(r){t.includes(r.id)||e.push(r)}),this.subForm.service=e,this.showDialog=!1},confirmDel:function(e){var t=this.subForm.service.findIndex(function(t){return t.id===e});this.subForm.service.splice(t,1)},submitForm:function(){var e=this;this.$refs.subForm.validate(function(t){if(t){var r=JSON.parse(a()(e.subForm)),s=r.id?"couponUpdate":"couponAdd";r.start_time=0===r.time_limit?r.start_time/1e3:"",r.end_time=0===r.time_limit?r.end_time/1e3:"",r.day=0===r.time_limit?"":r.day;var i=r.service.map(function(e){return e.id});r.service=i,e.$api.market[s](r).then(function(t){200===t.code&&(e.$message.success(e.$t(r.id?"tips.successRev":"tips.successSub")),e.$router.back(-1))})}})}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-market-edit"},[r("top-nav",{attrs:{title:e.navTitle,isBack:!0}}),e._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"卡券名称",prop:"title"}},[r("el-input",{attrs:{maxlength:"20","show-word-limit":"",placeholder:"请输入卡券名称"},model:{value:e.subForm.title,callback:function(t){e.$set(e.subForm,"title",t)},expression:"subForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"使用条件",prop:"type"}},[r("el-radio-group",{on:{change:function(t){return e.redMarketChange(t,"type")}},model:{value:e.subForm.type,callback:function(t){e.$set(e.subForm,"type",t)},expression:"subForm.type"}},[r("el-radio",{attrs:{label:0}},[e._v("消费满")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("无门槛")])],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"full"}},[0===e.subForm.type?r("block",[e._v("\n          消费满\n          "),r("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"请输入消费金额"},model:{value:e.subForm.full,callback:function(t){e.$set(e.subForm,"full",t)},expression:"subForm.full"}})],1):e._e(),e._v("\n        "+e._s(0===e.subForm.type?"元可用":"立减")+"\n        "),r("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:"请输入优惠金额"},model:{value:e.subForm.discount,callback:function(t){e.$set(e.subForm,"discount",t)},expression:"subForm.discount"}}),e._v(" "),1===e.subForm.type?r("block",[e._v("元")]):e._e()],1),e._v(" "),r("el-form-item",{attrs:{label:"使用规则",prop:"rule"}},[r("el-input",{attrs:{type:"textarea",rows:10,maxlength:"1000",resize:"none","show-word-limit":"",placeholder:"请输入使用规则"},model:{value:e.subForm.rule,callback:function(t){e.$set(e.subForm,"rule",t)},expression:"subForm.rule"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠详情",prop:"text"}},[r("el-input",{attrs:{type:"textarea",rows:10,maxlength:"1000",resize:"none","show-word-limit":"",placeholder:"请输入优惠详情"},model:{value:e.subForm.text,callback:function(t){e.$set(e.subForm,"text",t)},expression:"subForm.text"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"派发方式",prop:"send_type"}},[r("el-radio-group",{attrs:{disabled:!!e.subForm.id},on:{change:function(t){return e.redMarketChange(t,"send_type")}},model:{value:e.subForm.send_type,callback:function(t){e.$set(e.subForm,"send_type",t)},expression:"subForm.send_type"}},[r("el-radio",{attrs:{label:0}},[e._v("活动派发")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("用户领取")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("平台定向派发")])],1),e._v(" "),r("lb-tool-tips",[r("div",[e._v("\n            活动派发：需要参与活动，活动参与成功之后系统自动派发到用户的卡包\n          ")]),e._v(" "),r("div",{staticClass:"mt-sm"},[e._v("平台定向派发：平台指定派发到用户的卡包")])])],1),e._v(" "),2==e.subForm.send_type?r("el-form-item",{attrs:{label:"领取身份",prop:"user_limit"}},[r("el-radio-group",{model:{value:e.subForm.user_limit,callback:function(t){e.$set(e.subForm,"user_limit",t)},expression:"subForm.user_limit"}},[r("el-radio",{attrs:{label:1}},[e._v("不限制，任何人可领取")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("仅限新用户")])],1)],1):e._e(),e._v(" "),2==e.subForm.send_type?r("el-form-item",{attrs:{label:"卡券库存",prop:"stock"}},[r("el-input-number",{staticClass:"lb-input-number",attrs:{min:0,controls:!1,placeholder:"请输入卡券数量"},model:{value:e.subForm.stock,callback:function(t){e.$set(e.subForm,"stock",t)},expression:"subForm.stock"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"使用时间",prop:"time_limit"}},[r("el-radio-group",{model:{value:e.subForm.time_limit,callback:function(t){e.$set(e.subForm,"time_limit",t)},expression:"subForm.time_limit"}},[r("el-radio",{attrs:{label:0}},[e._v("指定日期")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("有效天数")])],1)],1),e._v(" "),0===e.subForm.time_limit?r("el-form-item",{attrs:{label:"",prop:"start_time"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择开始日期时间"},model:{value:e.subForm.start_time,callback:function(t){e.$set(e.subForm,"start_time",t)},expression:"subForm.start_time"}})],1):e._e(),e._v(" "),0===e.subForm.time_limit?r("el-form-item",{attrs:{label:"",prop:"end_time"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"选择结束日期时间"},model:{value:e.subForm.end_time,callback:function(t){e.$set(e.subForm,"end_time",t)},expression:"subForm.end_time"}}),e._v(" "),r("lb-tool-tips",[e._v("领取的卡券必须在该时间前使用")])],1):e._e(),e._v(" "),1===e.subForm.time_limit?r("el-form-item",{attrs:{label:"",prop:"day"}},[r("em",{staticClass:"text-normal"},[e._v("自领券当日起")]),e._v(" "),r("el-input-number",{staticClass:"lb-input-number mini",attrs:{controls:!1,min:1,precision:0},model:{value:e.subForm.day,callback:function(t){e.$set(e.subForm,"day",t)},expression:"subForm.day"}}),e._v(" "),r("em",{staticClass:"text-normal"},[e._v("天内可用")]),e._v(" "),r("lb-tool-tips",[e._v("有效期按自然天计算。\n          "),r("div",{staticClass:"mt-sm mb-sm"},[e._v("\n            举例：如设置领券当日起30天内可用，用户在5月18日14:00时领取卡券，则该卡券的可用时间为5月18日的14:00:00至6月18日的14:00\n          ")]),e._v("\n          注意：时间按自然天来算，不是月\n        ")])],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"排序值",prop:"top"}},[r("el-input-number",{staticClass:"lb-input-number",attrs:{min:0,controls:!1,placeholder:"请输入排序值"},model:{value:e.subForm.top,callback:function(t){e.$set(e.subForm,"top",t)},expression:"subForm.top"}}),e._v(" "),r("lb-tool-tips",[e._v("值越大, 排序越靠前")])],1),e._v(" "),r("el-form-item",{attrs:{label:"限用服务",prop:"service"}},[r("lb-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.toShowDialog}},[e._v("选择服务")]),e._v(" "),r("el-table",{staticClass:"mt-lg",staticStyle:{width:"100%"},attrs:{data:e.subForm.service,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[r("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),r("el-table-column",{attrs:{prop:"title",label:"服务名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"price",label:"服务价格"}}),e._v(" "),r("el-table-column",{attrs:{width:"180",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"table-operate"},[r("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(r){return e.confirmDel(t.row.id)}}},[e._v(e._s(e.$t("action.delete")))])],1)]}}])})],1)],1),e._v(" "),r("el-form-item",[r("lb-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v(e._s(e.$t("action.submit")))]),e._v(" "),r("lb-button",{on:{click:function(t){return e.$router.back(-1)}}},[e._v(e._s(e.$t("action.back")))])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"限用服务",visible:e.showDialog,width:"800px",center:""},on:{"update:visible":function(t){e.showDialog=t}}},[r("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{prop:"title",label:"服务名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"price",label:"服务价格"}})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var p=r("VU/8")(c,b,!1,function(e){r("JuCy")},"data-v-0f8578b2",null);t.default=p.exports},JuCy:function(e,t){}});